<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.korant.youya.workplace.mapper.WorkExperienceMapper">

    <!--    修改工作履历信息-->
    <update id="modify">
        UPDATE
            work_experience
        SET
            enterprise_name     = #{workExperienceModifyDto.enterpriseName},
            department_name     = #{workExperienceModifyDto.departmentName},
            position_name       = #{workExperienceModifyDto.positionName},
            start_time          = #{workExperienceModifyDto.startTime},
            end_time            = #{workExperienceModifyDto.endTime},
            content             =#{workExperienceModifyDto.content},
            performance         =#{workExperienceModifyDto.performance},
            update_time         = CURRENT_TIMESTAMP
        WHERE id = #{workExperienceModifyDto.id}
    </update>

    <!--    查询工作履历信息列表-->
    <select id="queryWorkExperienceListByUserId"
            resultType="com.korant.youya.workplace.pojo.vo.workexperience.WorkExperienceListVo">
        SELECT
            id,
            enterprise_name     AS enterpriseName,
            department_name     AS departmentName,
            position_name       AS positionName,
            start_time          AS startTime,
            end_time            AS endTime,
            content,
            performance
        FROM
            work_experience
        WHERE   uid = #{userId}
            AND is_delete = 0
        ORDER BY create_time DESC LIMIT #{pageSize}
        OFFSET (#{pageNumber} -1) * #{pageSize}
    </select>

    <!--    查询工作履历信息详情-->
    <select id="detail" resultType="com.korant.youya.workplace.pojo.vo.workexperience.WorkExperienceDetailVo">
        SELECT
            id,
            enterprise_name     AS enterpriseName,
            department_name     AS departmentName,
            position_name       AS positionName,
            start_time          AS startTime,
            end_time            AS endTime,
            content,
            performance
        FROM
            work_experience
        WHERE   id = #{id}
          AND is_delete = 0
    </select>

    <resultMap id="WorkExperienceAndProjectExperience" type="com.korant.youya.workplace.pojo.vo.workexperience.WorkExperiencePreviewVo">
        <id property="id" column="id" />
        <result property="enterpriseName" column="enterpriseName" />
        <result property="departmentName" column="departmentName" />
        <result property="positionName" column="positionName" />
        <result property="startTime" column="startTime" />
        <result property="endTime" column="endTime" />
        <result property="content" column="content" />
        <result property="performance" column="performance" />
        <collection property="experiencePreviewListVoList" ofType="com.korant.youya.workplace.pojo.vo.projectexperience.ProjectExperiencePreviewListVo">
            <id property="projectId" column="projectId" />
            <result property="projectName" column="projectName" />
            <result property="projectRole" column="projectRole" />
            <result property="projectContent" column="projectContent" />
        </collection>
    </resultMap>

    <!--    查询工作履历信息及其项目经验列表-->
    <select id="selectWorkExperienceAndProjectExperienceByUserId"
            resultType="com.korant.youya.workplace.pojo.vo.workexperience.WorkExperiencePreviewVo"
            resultMap="WorkExperienceAndProjectExperience">
        SELECT
            we.id,
            we.enterprise_name     AS enterpriseName,
            we.department_name     AS departmentName,
            we.position_name       AS positionName,
            we.start_time          AS startTime,
            we.end_time            AS endTime,
            we.content,
            we.performance,
            pe.id                  AS projectId,
            pe.project_name        AS projectName,
            pe.project_role        AS projectRole,
            pe.project_content     AS projectContent
        FROM
            work_experience we
            LEFT JOIN   project_experience pe   ON we.id = pe.we_id AND pe.is_delete = 0
        WHERE   we.uid = #{userId}
          AND we.is_delete = 0
    </select>

    <!--    查询工作履历所有公司-->
    <select id="WorkExperienceEnterpriseVo"
            resultType="com.korant.youya.workplace.pojo.vo.workexperience.WorkExperienceEnterpriseVo">
        SELECT
            id,
            enterprise_name     AS enterpriseName
        FROM
            work_experience
        WHERE   uid = #{userId}
          AND is_delete = 0
        ORDER BY create_time DESC
    </select>

</mapper>
