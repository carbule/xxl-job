<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.korant.youya.workplace.mapper.ExpectedWorkAreaMapper">

    <!--    查询用户期望工作区域-->
    <select id="queryList"
            resultType="com.korant.youya.workplace.pojo.vo.expectedworkarea.ExpectedWorkAreaInfoVo">
        SELECT
            ewa.id,
            ewa.country_id              AS countryId,
            dp1.name                   AS countryName,
            ewa.province_id             AS provinceId,
            dp2.name                   AS provinceName,
            ewa.city_id                 AS cityId,
            dp3.name                   AS cityName,
            ewa.district_id              AS districtId,
            dp4.name                   AS districtName,
            ewa.detailed_address        AS detailedAddress
        FROM   expected_work_area ewa
                    LEFT JOIN   job_intention ji ON ji.id = ewa.intention_id
                    LEFT JOIN   district_data dp1 ON dp1.id = ewa.country_id
                    LEFT JOIN   district_data dp2 ON dp2.id = ewa.province_id
                    LEFT JOIN   district_data dp3 ON dp3.id = ewa.city_id
                    LEFT JOIN   district_data dp4 ON dp4.id = ewa.district_id
        WHERE   ji.uid = #{userId}
          AND ewa.is_delete = 0
          AND ji.is_delete = 0
          AND dp1.is_delete = 0
          AND dp2.is_delete = 0
          AND dp3.is_delete = 0
          AND dp4.is_delete = 0
        ORDER BY ewa.create_time DESC
    </select>

    <!--    查询用户期望工作区域总数-->
    <select id="selectCountByUserId" resultType="java.lang.Long">
        SELECT
            COUNT(DISTINCT ewa.id)
        FROM   expected_work_area ewa
                   LEFT JOIN   job_intention ji ON ji.id = ewa.intention_id
        WHERE   ji.uid = #{userId}
          AND ewa.is_delete = 0
          AND ji.is_delete = 0
    </select>

</mapper>
