<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.korant.youya.workplace.mapper.EmployStatusMapper">

    <resultMap id="statusAndWorkAreaAndPosition" type="com.korant.youya.workplace.pojo.vo.employstatus.EmployStatusVo">
        <id property="id" column="id" />
        <result property="status" column="status" />
        <collection property="expectedWorkAreaInfoVoList" ofType="com.korant.youya.workplace.pojo.vo.expectedworkarea.ExpectedWorkAreaInfoVo" >
            <id property="id" column="ewaId" />
            <result property="countryCode" column="countryCode" />
            <result property="provinceCode" column="provinceCode" />
            <result property="cityCode" column="cityCode" />
            <result property="districtCode" column="districtCode" />
            <result property="countryName" column="countryName" />
            <result property="provinceName" column="provinceName" />
            <result property="cityName" column="cityName" />
            <result property="districtName" column="districtName" />
        </collection>
        <collection property="expectedPositionInfoVoList" ofType="com.korant.youya.workplace.pojo.vo.expectedposition.ExpectedPositionInfoVo">
            <id property="id" column="epId" />
            <result property="industryCode" column="industryCode" />
            <result property="industryName" column="industryName" />
            <result property="sectorCode" column="sectorCode" />
            <result property="sectorName" column="sectorName" />
            <result property="positionCode" column="positionCode" />
            <result property="positionName" column="positionName" />
            <result property="minSalary" column="minSalary" />
            <result property="maxSalary" column="maxSalary" />
        </collection>
    </resultMap>

    <!--    查询求职状态-->
    <select id="queryStatus" resultType="com.korant.youya.workplace.pojo.vo.employstatus.EmployStatusVo"
        resultMap="statusAndWorkAreaAndPosition">
        SELECT
            es.id,
            es.status,
            ewa.id                     AS ewaId,
            ewa.country_code           AS countryCode,
            dp1.name                   AS countryName,
            ewa.province_code          AS provinceCode,
            dp2.name                   AS provinceName,
            ewa.city_code              AS cityCode,
            dp3.name                   AS cityName,
            ewa.district_code          AS districtCode,
            dp4.name                   AS districtName,
            ep.id                      AS epId,
            ep.industry_code           AS industryCode,
            p1.name                    AS industryName,
            ep.sector_code             AS sectorCode,
            p2.name                    AS sectorName,
            ep.position_code           AS positionCode,
            p3.name                    AS positionName,
            ep.min_salary              AS minSalary,
            ep.max_salary              AS maxSalary
        FROM
            employ_status es
                LEFT JOIN   expected_work_area ewa ON ewa.status_id = es.id       AND ewa.is_delete = 0
                LEFT JOIN   district_data dp1 ON dp1.code = ewa.country_code      AND dp1.is_delete = 0
                LEFT JOIN   district_data dp2 ON dp2.code = ewa.province_code     AND dp2.is_delete = 0
                LEFT JOIN   district_data dp3 ON dp3.code = ewa.city_code         AND dp3.is_delete = 0
                LEFT JOIN   district_data dp4 ON dp4.code = ewa.district_code     AND dp4.is_delete = 0
                LEFT JOIN   expected_position ep ON ep.status_id = es.id      AND ep.is_delete = 0
                LEFT JOIN   position p1 ON p1.code = ep.industry_code             AND p1.is_delete = 0
                LEFT JOIN   position p2 ON p2.code = ep.sector_code               AND p2.is_delete = 0
                LEFT JOIN   position p3 ON p3.code = ep.position_code             AND p3.is_delete = 0
        WHERE   es.uid = #{userId}
          AND es.is_delete = 0
    </select>

</mapper>
