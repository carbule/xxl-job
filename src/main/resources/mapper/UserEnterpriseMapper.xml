<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.korant.youya.workplace.mapper.UserEnterpriseMapper">

    <!--    根据姓名查询公司同事总数-->
    <select id="queryCountColleagueByName" resultType="java.lang.Integer">
        SELECT
            COUNT(DISTINCT yu.id)
        FROM
        yy_user yu
        LEFT JOIN   yy_user_enterprise ue ON yu.id = ue.uid AND ue.is_delete = 0
        WHERE   ue.enterprise_id = #{id}
        <if test="name != null and name != ''">
            AND (yu.first_name like CONCAT('%', #{name},'%') OR yu.last_name like CONCAT('%', #{name},'%') )
        </if>
        AND yu.is_delete = 0
        AND yu.id != #{userId}
    </select>

    <!--    根据姓名查询公司同事-->
    <select id="queryColleagueByName"
            resultType="com.korant.youya.workplace.pojo.vo.userenterprise.UserEnterpriseColleagueInfoVo">
        SELECT
            yu.id,
            CONCAT(yu.last_name, yu.first_name )     AS name
        FROM
            yy_user yu
        LEFT JOIN   yy_user_enterprise ue ON yu.id = ue.uid AND ue.is_delete = 0
        WHERE   ue.enterprise_id = #{id}
        <if test="name != null and name != ''">
            AND (yu.first_name like CONCAT('%', #{name},'%') OR yu.last_name like CONCAT('%', #{name},'%') )
        </if>
            AND yu.is_delete = 0
            AND yu.id != #{userId}
        GROUP BY yu.id
        ORDER BY yu.create_time DESC LIMIT #{pageSize}
        OFFSET (#{pageNumber} -1) * #{pageSize}
    </select>


</mapper>
